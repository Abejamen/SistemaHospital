{% extends 'base.html' %}
{% block content %}
{% load static %}
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>{% block title %}Sistema Hospital{% endblock %}</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
</head>

<div class="container my-5">

    <h2 class="text-center fw-bold mb-4" style="color:#1a3d7c;">
        Bienvenido al sistema
    </h2>

    <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap">

        <a href="/formulario/0/" 
           class="btn btn-success btn-lg shadow-sm"
           style="border-radius: 10px; padding: 10px 22px;">
            <i class="bi bi-plus-circle me-1"></i> Crear nuevo formulario
        </a>

        <form method="get" class="mt-3 mt-md-0" style="max-width:520px; width:100%;">

            <div class="input-group input-group-lg shadow-sm">
                <input type="text" 
                       name="q" 
                       class="form-control"
                       placeholder="Buscar madre por nombre o RUT"
                       value="{{ request.GET.q }}"
                       style="border-radius: 12px 0 0 12px;">
                
                <button class="btn btn-primary"
                        type="submit"
                        style="border-radius: 0 12px 12px 0;">
                    <i class="bi bi-search"></i>
                </button>
            </div>

        </form>

    </div>

    <div class="card shadow-lg border-0" style="border-radius:20px;">

        <div class="card-header text-white fw-bold py-3"
             style="background: linear-gradient(90deg, #0d6efd, #0a58ca);
                    border-radius:20px 20px 0 0;
                    font-size: 1.3rem;">
            <i class="bi bi-journal-medical me-2"></i> Formularios Clínicos
        </div>

        <div class="table-responsive">
            <table class="table table-hover align-middle">

                <thead style="background-color:#dbe9ff;">
                    <tr>
                        <th class="py-3">NOMBRE MADRE</th>
                        <th class="py-3">RUT</th>
                        <th class="py-3">FECHA CREACIÓN</th>
                        <th class="py-3">CREADO POR</th>
                    </tr>
                </thead>

                <tbody>

                    {% for madre in madres %}
                    <tr onclick="window.location='/formulario/{{ madre.id }}/';"
                        class="fila-click"
                        style="cursor:pointer;">

                        <td class="fw-semibold">
                            <i class="bi bi-person-fill text-secondary me-2"></i>
                            {{ madre.nombre_completo }}
                        </td>

                        <td>
                            {% if madre.rut %}
                                {{ madre.rut }}
                            {% else %}
                                —
                            {% endif %}
                        </td>

                        <td>
                            <span class="badge bg-secondary p-2 px-3 fs-6 shadow-sm">
                                {{ madre.fecha_creacion|date:"d-m-Y H:i" }}
                            </span>
                        </td>

                        <td>
                            <i class="bi bi-person-badge me-2"></i>
                            {{ madre.creado_por.first_name }} {{ madre.creado_por.last_name }}
                        </td>

                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="4" class="text-center py-4 text-muted">
                            No hay formularios registrados
                        </td>
                    </tr>
                    {% endfor %}

                </tbody>

            </table>
        </div>
    </div>

</div>

{% endblock %}
