{% extends 'base.html' %}
{% load static %}

{% block content %}

<div class="container my-5">

    <h2 class="text-center fw-bold mb-4" style="color:#1a3d7c;">
        Bienvenido al sistema
    </h2>

    <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap">

        <a href="/formulario/0/" 
           class="btn btn-success btn-lg shadow-sm"
           style="border-radius: 10px; padding: 10px 22px;">
            <i class="bi bi-plus-circle me-1"></i> Crear nuevo formulario
        </a>

        <form method="get" class="mt-3 mt-md-0" style="max-width:520px; width:100%;">

            <div class="input-group input-group-lg shadow-sm">
                <input type="text" 
                       name="q" 
                       class="form-control"
                       placeholder="Buscar madre por nombre o RUT"
                       value="{{ q }}"
                       style="border-radius: 12px 0 0 12px;">
                
                <button class="btn btn-primary"
                        type="submit"
                        style="border-radius: 0 12px 12px 0;">
                    <i class="bi bi-search"></i>
                </button>
            </div>

        </form>

    </div>

    <ul class="nav nav-tabs mb-4" id="matronaTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active fw-semibold"
                    id="proceso-tab" 
                    data-bs-toggle="tab"
                    data-bs-target="#proceso"
                    type="button"
                    role="tab">
                Formularios en proceso
            </button>
        </li>

        <li class="nav-item" role="presentation">
            <button class="nav-link fw-semibold"
                    id="verificados-tab"
                    data-bs-toggle="tab"
                    data-bs-target="#verificados"
                    type="button"
                    role="tab">
                Formularios verificados
            </button>
        </li>
    </ul>

    <div class="tab-content" id="matronaTabsContent">


        <div class="tab-pane fade show active" id="proceso" role="tabpanel">

            <div class="card shadow-lg border-0" style="border-radius:20px;">
                <div class="card-header text-white fw-bold py-3"
                    style="background: linear-gradient(90deg, #0d6efd, #0a58ca);
                           border-radius:20px 20px 0 0;
                           font-size: 1.3rem;">
                    <i class="bi bi-hourglass-split me-2"></i> Formularios en Proceso
                </div>

                <div class="table-responsive">
                    <table class="table table-hover align-middle">
                        <thead style="background-color:#dbe9ff;">
                            <tr>
                                <th>NOMBRE MADRE</th>
                                <th>RUT</th>
                                <th>FECHA CREACIÓN</th>
                                <th>CREADO POR</th>
                            </tr>
                        </thead>

                        <tbody>
                            {% for m in en_proceso %}
                            <tr onclick="window.location='/formulario/{{ m.id }}/';" style="cursor:pointer;">
                                <td><i class="bi bi-person-fill text-secondary me-2"></i>{{ m.nombre_completo }}</td>
                                <td>{{ m.rut|default:"—" }}</td>
                                <td><span class="badge bg-secondary fs-6 p-2 shadow-sm">{{ m.fecha_creacion|date:"d-m-Y H:i" }}</span></td>
                                <td><i class="bi bi-person-badge me-2"></i>{{ m.creado_por.first_name }} {{ m.creado_por.last_name }}</td>
                            </tr>
                            {% empty %}
                            <tr><td colspan="4" class="text-center py-4 text-muted">No hay formularios en proceso.</td></tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>

            </div>

        </div>

        <div class="tab-pane fade" id="verificados" role="tabpanel">

            <div class="card shadow-lg border-0" style="border-radius:20px;">
                <div class="card-header bg-success text-white fw-bold py-3"
                    style="border-radius:20px 20px 0 0; font-size:1.3rem;">
                    <i class="bi bi-check-circle-fill me-2"></i> Formularios Verificados
                </div>

                <div class="table-responsive">
                    <table class="table table-hover align-middle">
                        <thead style="background-color:#d7f5d8;">
                            <tr>
                                <th>NOMBRE MADRE</th>
                                <th>RUT</th>
                                <th>FECHA VALIDACIÓN</th>
                                <th>VALIDADO POR</th>
                            </tr>
                        </thead>

                        <tbody>
                            {% for m in verificados %}
                            <tr onclick="window.location='/formulario/verificado/{{ m.id }}/';" style="cursor:pointer;">
                                <td><i class="bi bi-person-fill text-success me-2"></i>{{ m.nombre_completo }}</td>
                                <td>{{ m.rut|default:"—" }}</td>
                                <td><span class="badge bg-success fs-6 p-2 shadow-sm">{{ m.fecha_validacion|date:"d-m-Y H:i" }}</span></td>
                                <td><i class="bi bi-check2-circle me-2"></i>{{ m.validado_por.first_name }} {{ m.validado_por.last_name }}</td>
                            </tr>
                            {% empty %}
                            <tr><td colspan="4" class="text-center py-4 text-muted">No hay formularios verificados.</td></tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>

            </div>

        </div>

    </div>

</div>

{% endblock %}
