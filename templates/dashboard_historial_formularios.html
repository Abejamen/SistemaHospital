{% extends "base.html" %}

{% block content %}

<div class="container my-4">

    <a href="{% url 'supervisor_dashboard' %}" class="btn btn-outline-secondary mb-3">
        <i class="fa-solid fa-arrow-left"></i> Volver
    </a>

    <h2 class="fw-bold mb-4">Historial de Formularios e exportacion</h2>

    <div class="alert alert-secondary">
        Listado completo de todos los formularios creados por las matronas.
    </div>

    <div class="card shadow-sm">
        <div class="card-body p-0">

            <table class="table table-hover align-middle mb-0">
                <thead class="table-dark">
                    <tr>
                        <th>ID</th>
                        <th>Madre</th>
                        <th>RUT</th>
                        <th>Estado</th>
                        <th>Matrona</th>
                        <th>Fecha Creaci贸n</th>
                        <th>Acciones</th>
                    </tr>
                </thead>

                <tbody>
                    {% for f in formularios %}
                    <tr>
                        <td>#{{ f.id }}</td>
                        <td>{{ f.nombre_completo }}</td>
                        <td>{{ f.rut }}</td>

                        <td>
                            {% if f.estado == "BORRADOR" %}
                                <span class="badge bg-secondary">Borrador</span>
                            {% elif f.estado == "ENVIADO" %}
                                <span class="badge bg-warning text-dark">Enviado</span>
                            {% elif f.estado == "APROBADO" %}
                                <span class="badge bg-success">Aprobado</span>
                            {% elif f.estado == "RECHAZADO" %}
                                <span class="badge bg-danger">Rechazado</span>
                            {% endif %}
                        </td>

                        <td>{{ f.creado_por.first_name }} {{ f.creado_por.last_name }}</td>
                        <td>{{ f.fecha_creacion|date:"d/m/Y H:i" }}</td>

                        <td class="d-flex gap-1">

                            <!-- Bot贸n Ver -->
                            <a href="{% url 'supervisor_revisar' f.id %}" 
                               class="btn btn-outline-primary btn-sm" title="Ver">
                                <i class="fa-solid fa-eye"></i>
                            </a>

                            <!-- Bot贸n Exportar PDF -->
                            <a href="{% url 'formularios:exportar_pdf_individual' f.id %}" 
                               class="btn btn-danger btn-sm" title="Descargar PDF">
                                <i class="fa-solid fa-file-pdf"></i>
                            </a>

                            <!-- Bot贸n Exportar Excel -->
                            <a href="{% url 'formularios:exportar_excel_individual' f.id %}" 
                               class="btn btn-success btn-sm" title="Descargar Excel">
                                <i class="fa-solid fa-file-excel"></i>
                            </a>

                        </td>
                    </tr>

                    {% empty %}
                    <tr>
                        <td colspan="7" class="text-center py-3">No hay formularios registrados.</td>
                    </tr>
                    {% endfor %}
                </tbody>

            </table>

        </div>
    </div>

</div>

{% endblock %}
